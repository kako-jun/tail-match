# Tail Match - プロジェクト状況管理

## 📚 ドキュメント

### 開発フェーズ

- **[スクレイピング実装ガイド](./.claude/scraping-guide.md)** - 新規自治体追加の完全な手順
- **[よくある間違い](./.claude/common-mistakes.md)** - 過去の失敗から学んだ教訓
- **[スクレイピングアーキテクチャ](./.claude/scraping-architecture.md)** - 技術設計・実装方針
- **[履歴ロガー統合ガイド](./.claude/history-logger-guide.md)** - スクレイピング履歴管理システム

### 運用フェーズ

- **[運用ガイド](./.claude/operations-guide.md)** - 日常運用・トラブルシューティング手順
- **[保護施設データベース](./.claude/shelters.yaml)** - 全78施設の情報（実装済み22＋未実装56）

### その他

- **[プロジェクトREADME](./README.md)** - プロジェクト全体の説明

---

## 🎯 **現在の状況** (2025-11-13更新)

### ✅ **Phase 4.1 完了成果** (2025-07-01)

- **インフラ完全現代化**:
  - **Docker Compose現代化**: `docker compose` + `.yaml` 形式統一
  - **CI/CDパイプライン**: GitHub Actions完備（テスト・ビルド・デプロイ）
  - **本番環境設定**: Nginx + SSL + 自動デプロイスクリプト
  - **環境変数管理**: 開発・本番環境分離
- **命名統一完了**:
  - **ブランド統一**: 「TailMatch」→「Tail Match」全ファイル対応
  - **User-Agent更新**: ライブラリベース形式で礼儀正しいスクレイピング
- **管理機能実装**:
  - **スクレイピング管理画面**: `/admin/scraping` タイムライン表示
  - **統計ダッシュボード**: 成功率・実行時間・発見数監視
  - **API体系**: ログ・統計エンドポイント完備
- **包括的ドキュメント**: README・設定ガイド・使用方法完備

### ✅ **継続完了機能**

- **基盤システム**: Next.js + PostgreSQL + Python スクレイピング環境完成
- **フロントエンド完成**: Phase 3 UI/UX実装完了
  - 検索・フィルタリング機能 (地域・性別・年齢・緊急度)
  - 緊急度表示システム (視覚的アラート・アニメーション)
  - 統計ダッシュボード (リアルタイム集計・地域別分布)
  - 猫詳細ページ (完全レスポンシブ・連絡先情報)
- **UI/UX機能**:
  - **フルワイドヒーローカルーセル**: 明るい猫写真で訪問者を歓迎
  - **ハンバーガーメニュー**: モバイル完全対応、全機能にアクセス可能
  - **宇宙猫ゲーム**: サイトを明るくする進化型クリッカーゲーム
  - **保護センター一覧**: 全国の保護施設情報を体系化
  - **MUI完全統一**: 一貫したデザインシステム実現

### ✅ **Phase 4.2-part スクレイパー共通化・命名規則統一完了** (2025-11-13)

- **共通ヘルパー関数**: 全28施設で統一ロジックを使用（譲渡済み判定・動物種判定）
  - 詳細は [スクレイピングアーキテクチャ](./.claude/scraping-architecture.md#汎用化完了) 参照
- **命名規則統一**: -cats/-dogs サフィックス完備（猫専用17 + 犬専用7 + 混在4）
  - 詳細は [実装ガイド](./.claude/scraping-guide.md#命名規則) 参照
- **犬用ページ実装**: 7施設で犬用スクレイパーを追加実装
- **ドキュメント更新**: 共通化・命名規則を各ガイドに反映

### ✅ **Phase 4.2-part2 履歴ロガー完全統合完了** (2025-11-13)

- **カウント継承システム実装**:
  - `history-logger.js` に `loadPreviousCounts()` メソッド実装
  - scrape.js → html-to-yaml.js → yaml-to-db.js の完全なパイプライン追跡
- **全施設ロガー統合**:
  - 28施設すべての html-to-yaml.js に logger.start() / loadPreviousCounts() / finalize() を統合
  - 自動一括更新スクリプト作成: `scripts/update-all-html-to-yaml-loggers.js`
- **自動不一致検出**:
  - HTML→YAML で1匹でも減少したら自動警告
  - YAML→DB で1匹でも減少したら自動警告
  - サマリー表示: `scripts/show-scraping-summary.js`
- **バグ修正**:
  - 千葉市: 全角・半角括弧混在問題を修正（17→15不一致を解消）
  - 詳細は [バグ修正ログ](./.claude/bugfix-log.md) 参照
- **運用準備完了**:
  - `scripts/run-all-scrapers.sh` でDB初期化→全施設スクレイピング→サマリー表示の完全自動化
  - 不一致検出率: 3.6%（1/28施設）

### ⚠️ **残存技術課題**

- **📋 データベース接続**: スクレイピング実行時の接続問題（要調査）
- **📋 Next.js設定**: standalone build設定が未完了

詳細は [scraping-architecture.md](./.claude/scraping-architecture.md) を参照。

### ✅ **Phase 4.3 法的整備完了** (2025-07-01)

- **法的ページ作成**: プライバシーポリシー・利用規約・免責事項
- **ユーザビリティ重視**: 簡潔版＋詳細版の2段構成
- **透明性確保**: 収集しない個人情報を明確に列挙
- **視覚的デザイン**: ✅❌アイコン・色分け・2カラムレイアウト
- **フッターリンク**: 全ページからアクセス可能

### 🚀 **優先実装順序** (Phase 4.4以降) - 2025-11-13更新

1. **🔥 HIGH**: 全国展開（残り56施設のスクレイパー実装）
   - 政令指定都市（仙台、新潟、静岡、浜松、名古屋、京都、岡山、広島、北九州、福岡、熊本）
   - 県庁所在地（36都市）
   - 詳細は [shelters.yaml](./.claude/shelters.yaml) 参照
2. **📋 MED**: 管理画面APIエラー修正（スクレイピング履歴表示）
3. **📋 MED**: Database接続修正
4. **📋 MED**: Next.js standalone build設定
5. **📋 LOW**: 堺市・横浜市の完全自動化（画像OCR統合 or HTML化）

**解決済み（2025-11-13）**:

- ✅ Playwright動的スクレイピング実装（全28施設）
- ✅ 実データ取得システム構築（html-to-yaml.js、全28施設）
- ✅ JavaScriptサイト対応（5秒待機、全28施設）
- ✅ フォールバック抽出問題の解決（実データ取得に移行）
- ✅ 犬用ページの実装（7施設）
- ✅ 譲渡済み判定の統一（28施設）
- ✅ 動物種判定の強化（愛称表記対応）
- ✅ 共通ヘルパー関数の実装（adoption-status.js、animal-type.js）
- ✅ 犬用ページの完全無視問題（7施設）
- ✅ status（譲渡済み）フィールド未実装問題（28施設）
- ✅ 「ワンちゃん」「わんちゃん」表記漏れ問題
- ✅ 履歴ロガー統合（全28施設、HTML→YAML→DB不一致検出）
- ✅ 運用スクリプト作成（`scripts/run-all-scrapers.sh`）
- ✅ 運用ドキュメント作成（`.claude/operations-guide.md`）
- ✅ 定期実行・監視システム（cron設定手順、ログ確認、エラー通知）

---

## 実装記録

**Phase 1**: 基盤構築 ✅ 完了 (2024-12-30)
**Phase 2**: スクレイピングシステム ✅ 完了 (2025-11-13) - 3ステップパイプライン確立
**Phase 3**: UI/UX完成 ✅ 完了 (2024-06-30) - ヒーローカルーセル・ハンバーガーメニュー・宇宙猫ゲーム追加
**Phase 4.1**: インフラ現代化 ✅ 完了 (2025-07-01) - Docker現代化・CI/CD・管理画面完備
**Phase 4.3**: 法的整備 ✅ 完了 (2025-07-01) - プライバシーポリシー・利用規約・免責事項
**Phase 4.2-part**: スクレイパー共通化・命名規則統一 ✅ 完了 (2025-11-13)
**Phase 4.2**: 複数自治体対応 🔄 **進行中** - 28/78施設実装完了（36%）
