# バグ修正ログ

## 2025-11-13: 千葉市 html-to-yaml.js 括弧パターン問題

### 症状

- **HTML検出数**: 17匹
- **YAML抽出数**: 15匹
- **不一致**: HTML→YAMLで2匹減少

### 原因

html-to-yaml.js の正規表現が**全角括弧（）のみ**を認識していたが、HTMLには**半角括弧()を使った動物**が2匹存在：

- **ザク** (25092901(ザク))
- **ホーク** (24100905(ホーク))

### 修正箇所

**ファイル**: `scripts/scrapers/chiba/chiba-city-cats/html-to-yaml.js`

**修正前**:

```javascript
// Line 40
const match = heading.match(/(\d{8})（(.+?)）/);

// Line 120
if ($h4.text().match(/\d{8}（.+?）/)) {
```

**修正後**:

```javascript
// Line 41 - 全角（）と半角()の両方に対応
const match = heading.match(/(\d{8})[（(](.+?)[）)]/);

// Line 121 - 全角（）と半角()の両方に対応
if ($h4.text().match(/\d{8}[（(].+?[）)]/)) {
```

### 結果

- ✅ YAML抽出数: 15匹 → **17匹**
- ✅ ステータス: mismatch → **success**
- ✅ 警告: HTML→YAMLで2匹減少 → **null**

### 教訓

1. **文字種の混在に注意**: 日本語HTMLでは全角・半角の混在が頻繁
2. **包括的な正規表現**: `[（(]` と `[）)]` で両方に対応
3. **ロガー統合の効果**: カウント継承システムで不一致を即座に検出
4. **テストデータの重要性**: 実際のHTMLで複数パターンを確認すべき

### 今後の対策

新規施設追加時のチェックリスト：

- [ ] 全角・半角の括弧が混在していないか
- [ ] スペース（全角・半角）が混在していないか
- [ ] ハイフン（全角・半角）が混在していないか
- [ ] その他の記号の文字種統一を確認

### 関連ドキュメント

- [履歴ロガー統合ガイド](./.claude/history-logger-guide.md)
- [新規自治体追加ガイド](../NEW_MUNICIPALITY_GUIDE.md)
