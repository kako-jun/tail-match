#!/bin/bash

# ================================================================
# 京都府動物愛護管理センター（犬） 完全自動スクレイピングスクリプト
# ================================================================
#
# 使用方法:
#   ./scripts/scrapers/kyoto/kyoto-pref-dogs/run-full-scrape.sh
#
# 実行内容:
#   1. HTMLをスクレイピング
#   2. HTMLからYAMLに情報を抽出
#
# ================================================================

set -e  # エラーで停止

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../../../.." && pwd)"
cd "$PROJECT_ROOT"

echo "============================================================"
echo "🐱 京都府動物愛護管理センター（犬） - 完全自動スクレイピング"
echo "============================================================"
echo ""

# ================================================================
# Step 1: HTMLをスクレイピング
# ================================================================

echo "[Step 1] HTMLをスクレイピング中..."

node "$SCRIPT_DIR/scrape.js"

echo ""

# ================================================================
# Step 2: HTMLからYAMLに抽出
# ================================================================

echo "[Step 2] HTMLからYAMLに情報を抽出中..."

node "$SCRIPT_DIR/html-to-yaml.js"

echo ""

# ================================================================
# 完了
# ================================================================

echo "============================================================"
echo "✅ 自動スクレイピング完了"
echo "============================================================"
echo ""
echo "次のステップ:"
echo "  1. data/yaml/kyoto/kyoto-pref-dogs/ のYAMLファイルを確認"
echo "  2. データベースに投入:"
echo "     node scripts/yaml-to-db.js"
echo ""
