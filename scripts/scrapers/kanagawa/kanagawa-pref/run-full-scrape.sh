#!/bin/bash

# ================================================================
# 神奈川県動物愛護センター 完全自動スクレイピングスクリプト
# ================================================================
#
# 使用方法:
#   ./scripts/scrapers/kanagawa/kanagawa-pref/run-full-scrape.sh
#
# 実行内容:
#   1. 譲渡猫ページのHTMLをスクレイピング（全ページ自動収集）
#   2. HTMLからYAMLに情報を抽出
#   3. データベースに投入準備完了
#
# ================================================================

set -e  # エラーで停止

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../../../.." && pwd)"
cd "$PROJECT_ROOT"

echo "============================================================"
echo "🐱 神奈川県動物愛護センター - 完全自動スクレイピング"
echo "============================================================"
echo ""

# ================================================================
# Step 1: HTMLをスクレイピング（全ページ）
# ================================================================

echo "[Step 1] 譲渡猫ページのHTMLをスクレイピング中（全ページ自動収集）..."

node "$SCRIPT_DIR/scrape.js"

echo ""

# ================================================================
# Step 2: HTMLからYAMLに抽出
# ================================================================

echo "[Step 2] HTMLからYAMLに情報を抽出中..."

node "$SCRIPT_DIR/html-to-yaml.js"

echo ""

# ================================================================
# 完了
# ================================================================

echo "============================================================"
echo "✅ 自動スクレイピング完了"
echo "============================================================"
echo ""
echo "次のステップ:"
echo "  1. data/yaml/kanagawa/kanagawa-pref/ のYAMLファイルを確認"
echo "  2. データベースに投入:"
echo "     node scripts/yaml-to-db.js"
echo ""
